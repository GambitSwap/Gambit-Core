import { Button, VerticalBox, HorizontalBox, TextEdit, ScrollView, ListView, TabWidget } from "std-widgets.slint";

export component MainWindow inherits Window {
    title: "Gambit Blockchain Node";
    icon: @image-url("logo.png");
    width: 1200px;
    height: 800px;
    
    TabWidget {
        Tab {
            title: "Dashboard";
            
            VerticalBox {
                Text {
                    text: "Gambit Node Status";
                    font-size: 24px;
                    font-weight: 700;
                }
                
                HorizontalBox {
                    Text { text: "Block Height: "; }
                    Text { text: root.block-height; color: green; }
                }
                
                HorizontalBox {
                    Text { text: "Chain ID: "; }
                    Text { text: root.chain-id; color: blue; }
                }
                
                HorizontalBox {
                    Text { text: "P2P Status: "; }
                    Text { text: root.p2p-status; color: root.p2p-status == "Connected" ? green : red; }
                }
                
                HorizontalBox {
                    Text { text: "RPC Status: "; }
                    Text { text: root.rpc-status; color: root.rpc-status == "Running" ? green : red; }
                }
                
                Button {
                    text: root.mining-active ? "Stop Mining" : "Start Mining";
                    clicked => { root.toggle-mining(); }
                }
                
                Button {
                    text: "Mine Block";
                    clicked => { root.mine-single-block(); }
                }
            }
        }
        
        Tab {
            title: "Blocks";
            
            VerticalBox {
                HorizontalBox {
                    Text { text: "Block Number:"; }
                    TextEdit { 
                        text: root.search-block-number;
                        accepted => { root.search-block(); }
                    }
                    Button { 
                        text: "Search";
                        clicked => { root.search-block(); }
                    }
                }
                
                ScrollView {
                    ListView {
                        for block[index] in root.blocks: Rectangle {
                            height: 60px;
                            HorizontalBox {
                                Text { text: "Block #" + block.number; }
                                Text { text: "Hash: " + block.hash; }
                                Text { text: "Tx: " + block.transaction-count; }
                            }
                        }
                    }
                }
            }
        }
        
        Tab {
            title: "Wallet";
            
            VerticalBox {
                Button {
                    text: "Create Wallet";
                    clicked => { root.create-wallet(); }
                }
                
                Button {
                    text: "Load Wallet";
                    clicked => { root.load-wallet(); }
                }
                
                ScrollView {
                    ListView {
                        for account in root.accounts: Rectangle {
                            height: 40px;
                            HorizontalBox {
                                Text { text: account.name; }
                                Text { text: account.address; }
                                Text { text: account.balance; }
                            }
                        }
                    }
                }
            }
        }
        
        Tab {
            title: "Transactions";
            
            VerticalBox {
                Button {
                    text: "Send Transaction";
                    clicked => { root.send-transaction(); }
                }
                
                ScrollView {
                    ListView {
                        for tx in root.transactions: Rectangle {
                            height: 40px;
                            HorizontalBox {
                                Text { text: "From: " + tx.from; }
                                Text { text: "To: " + tx.to; }
                                Text { text: "Value: " + tx.value; }
                            }
                        }
                    }
                }
            }
        }
    }
    
    // Properties
    in-out property <string> block-height: "0";
    in-out property <string> chain-id: "1337";
    in-out property <string> p2p-status: "Disconnected";
    in-out property <string> rpc-status: "Stopped";
    in-out property <bool> mining-active: false;
    in-out property <string> search-block-number: "";
    
    // Data models
    in-out property <[string]> blocks;
    in-out property <[AccountData]> accounts;
    in-out property <[TransactionData]> transactions;
    
    // Callbacks
    callback toggle-mining();
    callback mine-single-block();
    callback search-block();
    callback create-wallet();
    callback load-wallet();
    callback send-transaction();
}

// Data structures
export struct BlockData {
    number: string,
    hash: string,
    transaction-count: string,
}

export struct AccountData {
    name: string,
    address: string,
    balance: string,
}

export struct TransactionData {
    from: string,
    to: string,
    value: string,
}